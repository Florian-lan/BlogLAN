{"ast":null,"code":"var _jsxFileName = \"/Users/florianlan/Desktop/Florian/Project/Blog/BlogLan/client/src/pages/Single/Single.jsx\",\n  _s = $RefreshSig$();\nimport React from 'react';\nimport { useState, useEffect, useContext } from 'react';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\nimport './style.scss';\nimport Menu from '../../Components/Menu/Menu';\nimport { DeleteOutlined, EditOutlined } from '@ant-design/icons';\nimport axios from 'axios';\nimport { AuthContext } from '../../context/authContext.js';\nimport moment from 'moment';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Single = () => {\n  _s();\n  const IMG = 'https://static.www.tencent.com/uploads/2022/12/28/646a1b54211af41b82eff20a60bdc550.png!article.cover';\n  const navigate = useNavigate();\n  const [post, setPost] = useState({\n    id: 0,\n    username: '',\n    title: '',\n    desc: '',\n    img: '',\n    userImg: '',\n    cat: '',\n    // date初始化TODO\n    date: '1900-01-01T04:00:00.000Z'\n  });\n  const {\n    currentUser\n  } = useContext(AuthContext);\n\n  // 获取需要显示的postid\n  const location = useLocation();\n  // location.pathname is like localhost:3000/post/1\n  const postId = location.pathname.split('/')[2];\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const res = await axios.get(`http://localhost:8800/api/posts/${postId}`);\n        // 根据从数据库中返回的数据设置post信息\n        setPost(res.data);\n        console.log(post);\n        // post信息就是从数据库中返回的信息，/controllers/posts，取决于sql命令SELECT\n      } catch (err) {\n        console.log(err);\n      }\n    };\n    fetchData();\n    // 别忘了useEffect的依赖项，postID改变时才刷新\n  }, [postId]);\n  const handleEdit = () => {\n    {/* TODO URL 中的问号有什么作用 */}\n    navigate('/write?edit=2', {\n      state: post\n    });\n  };\n  const handleDelete = async () => {\n    try {\n      await axios.delete(`http://localhost:8800/api/posts/${postId}`);\n      navigate('/');\n    } catch (err) {\n      console.log(err);\n    }\n  };\n  const getText = html => {\n    const doc = new DOMParser().parseFromString(html, 'text/html');\n    return doc.body.textContent;\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"single\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content\",\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: `../upload/${post === null || post === void 0 ? void 0 : post.img}`,\n        alt: \"\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"user\",\n        children: [post.userImg && /*#__PURE__*/_jsxDEV(\"img\", {\n          src: post.userImg,\n          alt: \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 28\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"info\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"userName\",\n            children: [\" \", post.username, \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 91,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"Posted \", moment(post.date).fromNow()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"func\",\n          children: [console.log(currentUser), post.username === currentUser && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"func\",\n            children: [/*#__PURE__*/_jsxDEV(EditOutlined, {\n              className: \"edit\",\n              style: {\n                fontSize: '25px'\n              },\n              onClick: handleEdit\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 99,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(DeleteOutlined, {\n              className: \"delete\",\n              style: {\n                fontSize: '25px'\n              },\n              onClick: handleDelete\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 16\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"head\",\n          children: post.title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"plot\",\n          children: getText(post.desc)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"menu\",\n      children: /*#__PURE__*/_jsxDEV(Menu, {\n        cat: post.cat\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 5\n  }, this);\n};\n_s(Single, \"gRcrPt2v2pbhfaqrcVNA4JT7yIQ=\", false, function () {\n  return [useNavigate, useLocation];\n});\n_c = Single;\nexport default Single;\nvar _c;\n$RefreshReg$(_c, \"Single\");","map":{"version":3,"names":["React","useState","useEffect","useContext","Link","useNavigate","useLocation","Menu","DeleteOutlined","EditOutlined","axios","AuthContext","moment","Single","IMG","navigate","post","setPost","id","username","title","desc","img","userImg","cat","date","currentUser","location","postId","pathname","split","fetchData","res","get","data","console","log","err","handleEdit","state","handleDelete","delete","getText","html","doc","DOMParser","parseFromString","body","textContent","fromNow","fontSize"],"sources":["/Users/florianlan/Desktop/Florian/Project/Blog/BlogLan/client/src/pages/Single/Single.jsx"],"sourcesContent":["import React from 'react';\nimport {\n  useState,\n  useEffect,\n  useContext\n} from 'react'\n\nimport {\n  Link,\n  useNavigate,\n  useLocation\n} from 'react-router-dom';\nimport './style.scss';\nimport Menu from '../../Components/Menu/Menu'\nimport {\n  DeleteOutlined,\n  EditOutlined,\n} from '@ant-design/icons'\nimport axios from 'axios';\nimport { AuthContext } from '../../context/authContext.js'\nimport moment from 'moment'\n\n\nconst Single = () => {\n  const IMG = 'https://static.www.tencent.com/uploads/2022/12/28/646a1b54211af41b82eff20a60bdc550.png!article.cover';\n  const navigate = useNavigate();\n  const [post, setPost] = useState({\n    id: 0,\n    username: '',\n    title: '',\n    desc: '',\n    img: '',\n    userImg: '',\n    cat: '',\n    // date初始化TODO\n    date: '1900-01-01T04:00:00.000Z',\n  })\n  const { currentUser } = useContext(AuthContext)\n\n  // 获取需要显示的postid\n  const location = useLocation()\n  // location.pathname is like localhost:3000/post/1\n  const postId = location.pathname.split('/')[2]\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const res = await axios.get(`http://localhost:8800/api/posts/${postId}`)\n        // 根据从数据库中返回的数据设置post信息\n        setPost(res.data)\n        console.log(post)\n        // post信息就是从数据库中返回的信息，/controllers/posts，取决于sql命令SELECT\n\n\n      } catch (err) {\n        console.log(err)\n      }\n    }\n    fetchData()\n    // 别忘了useEffect的依赖项，postID改变时才刷新\n  }, [postId])\n\n\n  const handleEdit = () => {\n    {/* TODO URL 中的问号有什么作用 */ }\n    navigate('/write?edit=2',{state:post});\n  }\n\n  const handleDelete = async ()=>{\n    try{\n      await axios.delete(`http://localhost:8800/api/posts/${postId}`);\n      navigate('/');\n    }catch(err){\n      console.log(err)\n    }\n  }\n\n  const getText = (html) =>{\n    const doc = new DOMParser().parseFromString(html,'text/html')\n    return doc.body.textContent\n  }\n  return (\n    <div className=\"single\">\n      <div className=\"content\">\n        {/* <img src=\"../imgs/batman.jpg\" alt=\"\" /> */}\n        <img src={`../upload/${post?.img}`} alt=\"\" />\n        <div className=\"user\">\n          {post.userImg && <img src={post.userImg} alt=\"\" />}\n\n          <div className=\"info\">\n            <span className=\"userName\"> {post.username} </span>\n            {/* {console.log(post.date)} */}\n            <p>Posted {moment(post.date).fromNow()}</p>\n          </div>\n          <div className=\"func\">\n            {console.log(currentUser)}\n            {post.username === currentUser &&\n              (<div className=\"func\">\n                <EditOutlined className='edit' style={{ fontSize: '25px' }} onClick={handleEdit} />\n                <DeleteOutlined className='delete' style={{ fontSize: '25px' }} onClick={handleDelete}/>\n              </div>)\n            }\n\n          </div>\n\n        </div>\n        <div className=\"text\">\n          <h1 className=\"head\">\n            {post.title}\n          </h1>\n          <p className=\"plot\">\n            {getText(post.desc)}\n          </p>\n        </div>\n      </div>\n      <div className=\"menu\">\n      {/* 将cat传递给menu组件进行“推荐” */}\n        <Menu cat={post.cat}/>\n      </div>\n\n    </div>\n  )\n}\n\n\nexport default Single"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}