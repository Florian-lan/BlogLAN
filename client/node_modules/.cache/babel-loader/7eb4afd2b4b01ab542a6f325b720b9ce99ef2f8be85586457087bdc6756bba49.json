{"ast":null,"code":"var _s = $RefreshSig$();\nimport React from 'react';\nimport { useState, useEffect, useContext } from 'react';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\nimport './style.scss';\nimport Menu from '../../Components/Menu/Menu';\nimport { DeleteOutlined, EditOutlined } from '@ant-design/icons';\nimport axios from 'axios';\nimport { AuthContext } from '../../context/authContext.js';\nimport moment from 'moment';\nconst Single = () => {\n  _s();\n  const IMG = 'https://static.www.tencent.com/uploads/2022/12/28/646a1b54211af41b82eff20a60bdc550.png!article.cover';\n  const navigate = useNavigate();\n  const [post, setPost] = useState({\n    id: 0,\n    username: '',\n    title: '',\n    desc: '',\n    img: '',\n    userImg: '',\n    cat: '',\n    // date初始化TODO\n    date: '1900-01-01T04:00:00.000Z'\n  });\n  const {\n    currentUser\n  } = useContext(AuthContext);\n\n  // 获取需要显示的postid\n  const location = useLocation();\n  // location.pathname is like localhost:3000/post/1\n  const postId = location.pathname.split('/')[2];\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const res = await axios.get(`http://localhost:8800/api/posts/${postId}`);\n        // 根据从数据库中返回的数据设置post信息\n        setPost(res.data);\n        console.log(post);\n        // post信息就是从数据库中返回的信息，/controllers/posts，取决于sql命令SELECT\n      } catch (err) {\n        console.log(err);\n      }\n    };\n    fetchData();\n    // 别忘了useEffect的依赖项，postID改变时才刷新\n  }, [postId]);\n  const handleEdit = () => {\n    {/* TODO URL 中的问号有什么作用 */}\n    navigate('/write?edit=2', {\n      state: post\n    });\n  };\n  const handleDelete = async () => {\n    try {\n      await axios.delete(`http://localhost:8800/api/posts/${postId}`);\n      navigate('/');\n    } catch (err) {\n      console.log(err);\n    }\n  };\n  const getText = html => {\n    const doc = new DOMParser().parseFromString(html, 'text/html');\n    return doc.body.textContent;\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"single\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content\"\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: `../upload/${post?.img}`,\n    alt: \"\"\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"user\"\n  }, post.userImg && /*#__PURE__*/React.createElement(\"img\", {\n    src: post.userImg,\n    alt: \"\"\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"info\"\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"userName\"\n  }, \" \", post.username, \" \"), /*#__PURE__*/React.createElement(\"p\", null, \"Posted \", moment(post.date).fromNow())), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"func\"\n  }, console.log(currentUser), post.username === currentUser && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"func\"\n  }, /*#__PURE__*/React.createElement(EditOutlined, {\n    className: \"edit\",\n    style: {\n      fontSize: '25px'\n    },\n    onClick: handleEdit\n  }), /*#__PURE__*/React.createElement(DeleteOutlined, {\n    className: \"delete\",\n    style: {\n      fontSize: '25px'\n    },\n    onClick: handleDelete\n  })))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"text\"\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    className: \"head\"\n  }, post.title), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"plot\"\n  }, getText(post.desc)))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"menu\"\n  }, /*#__PURE__*/React.createElement(Menu, {\n    cat: post.cat\n  })));\n};\n_s(Single, \"gRcrPt2v2pbhfaqrcVNA4JT7yIQ=\", false, function () {\n  return [useNavigate, useLocation];\n});\n_c = Single;\nexport default Single;\nvar _c;\n$RefreshReg$(_c, \"Single\");","map":{"version":3,"names":["React","useState","useEffect","useContext","Link","useNavigate","useLocation","Menu","DeleteOutlined","EditOutlined","axios","AuthContext","moment","Single","IMG","navigate","post","setPost","id","username","title","desc","img","userImg","cat","date","currentUser","location","postId","pathname","split","fetchData","res","get","data","console","log","err","handleEdit","state","handleDelete","delete","getText","html","doc","DOMParser","parseFromString","body","textContent","fromNow","fontSize"],"sources":["/Users/florianlan/Desktop/Florian/Project/Blog/BlogLan/client/src/pages/Single/Single.jsx"],"sourcesContent":["import React from 'react';\nimport {\n  useState,\n  useEffect,\n  useContext\n} from 'react'\n\nimport {\n  Link,\n  useNavigate,\n  useLocation\n} from 'react-router-dom';\nimport './style.scss';\nimport Menu from '../../Components/Menu/Menu'\nimport {\n  DeleteOutlined,\n  EditOutlined,\n} from '@ant-design/icons'\nimport axios from 'axios';\nimport { AuthContext } from '../../context/authContext.js'\nimport moment from 'moment'\n\n\nconst Single = () => {\n  const IMG = 'https://static.www.tencent.com/uploads/2022/12/28/646a1b54211af41b82eff20a60bdc550.png!article.cover';\n  const navigate = useNavigate();\n  const [post, setPost] = useState({\n    id: 0,\n    username: '',\n    title: '',\n    desc: '',\n    img: '',\n    userImg: '',\n    cat: '',\n    // date初始化TODO\n    date: '1900-01-01T04:00:00.000Z',\n  })\n  const { currentUser } = useContext(AuthContext)\n\n  // 获取需要显示的postid\n  const location = useLocation()\n  // location.pathname is like localhost:3000/post/1\n  const postId = location.pathname.split('/')[2]\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const res = await axios.get(`http://localhost:8800/api/posts/${postId}`)\n        // 根据从数据库中返回的数据设置post信息\n        setPost(res.data)\n        console.log(post)\n        // post信息就是从数据库中返回的信息，/controllers/posts，取决于sql命令SELECT\n\n\n      } catch (err) {\n        console.log(err)\n      }\n    }\n    fetchData()\n    // 别忘了useEffect的依赖项，postID改变时才刷新\n  }, [postId])\n\n\n  const handleEdit = () => {\n    {/* TODO URL 中的问号有什么作用 */ }\n    navigate('/write?edit=2',{state:post});\n  }\n\n  const handleDelete = async ()=>{\n    try{\n      await axios.delete(`http://localhost:8800/api/posts/${postId}`);\n      navigate('/');\n    }catch(err){\n      console.log(err)\n    }\n  }\n\n  const getText = (html) =>{\n    const doc = new DOMParser().parseFromString(html,'text/html')\n    return doc.body.textContent\n  }\n  return (\n    <div className=\"single\">\n      <div className=\"content\">\n        {/* <img src=\"../imgs/batman.jpg\" alt=\"\" /> */}\n        <img src={`../upload/${post?.img}`} alt=\"\" />\n        <div className=\"user\">\n          {post.userImg && <img src={post.userImg} alt=\"\" />}\n\n          <div className=\"info\">\n            <span className=\"userName\"> {post.username} </span>\n            {/* {console.log(post.date)} */}\n            <p>Posted {moment(post.date).fromNow()}</p>\n          </div>\n          <div className=\"func\">\n            {console.log(currentUser)}\n            {post.username === currentUser &&\n              (<div className=\"func\">\n                <EditOutlined className='edit' style={{ fontSize: '25px' }} onClick={handleEdit} />\n                <DeleteOutlined className='delete' style={{ fontSize: '25px' }} onClick={handleDelete}/>\n              </div>)\n            }\n\n          </div>\n\n        </div>\n        <div className=\"text\">\n          <h1 className=\"head\">\n            {post.title}\n          </h1>\n          <p className=\"plot\">\n            {getText(post.desc)}\n          </p>\n        </div>\n      </div>\n      <div className=\"menu\">\n      {/* 将cat传递给menu组件进行“推荐” */}\n        <Menu cat={post.cat}/>\n      </div>\n\n    </div>\n  )\n}\n\n\nexport default Single"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}